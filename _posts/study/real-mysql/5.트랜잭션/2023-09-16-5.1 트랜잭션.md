---
title: 5.1 트랜잭션

categories:
- real-mysql

tags:
- database
- study

toc: true
toc_sticky: true
toc_label: Contents
---

> 트랜잭션은 작업의 완전성을 보장해 주는 것이다.\
> 논리적인 작업 셋을 모두 완벽하게 처리하거나, 처리하지 못할 경우엔 원 상태로 복구해서 작업의 일부만 적용되는 현상을 (Partial Update)를 발생하지 않게 해준다.

> 잠금(Lock) vs 트랜잭션(Transaction)\
> 잠금: 동시성을 제어하기 위한 기능\
>
>
> * 잠금은 여러 커넥션에서 동시에 동일한 자원을 요청할 경우 순서대로, 하나의 커넥션만 변경할 수 있게 한다.
> * 잠금이 없으면, 여러 커넥션에서 동시에 변경할 수 있게 된다 → 결과적으로 해당 레코드의 값을 예측할 수 없게 된다.
>
> 트랜잭션: 데이터의 정합성을 보장하기 위한 기능\
>
>
> * 트랜잭션 격리수준이라는 것은 하나 혹은 여러 트랜잭션 간의 작업 내용을 어떻게 공유하고 차단할 것인지 결정하는 레벨이다.

### 5.1.1 MySQL에서의 트랜잭션

트랜잭션: 쿼리의 수와 관계없이 하나의 논리적인 작업셋 자체가 100% 적용되거나, 아무것도 적용되지 않아야 함을 보장해주는 것.

> 어떤 사용자는 트랜잭션을 상당히 골치 아픈 기능으로 생각하지만, 트랜잭션이란 어플리케이션 개발에서 고민해야 할 문제를 줄여주는 아주 필수적인 DBMS 기능이다.\
>

### 5.1.2 주의사항

트랜잭션 또한 DBMS의 커넥션과 동일하게 꼭 필요한 최소의 코드에만 적용하는 것이 좋다.→ 프로그램 코드에서 트랜색션 범위를 최소화 해라.

```
## 트랜잭션 처리 예제 (1~10번까지 하나의 트랜잭션)
1) 처리 시작
=> 데이터베이스 커넥션 생성 // 데이터베이스의 커넥션을 생성(또는 커넥션 풀에서 가져옴)
=> 트랜잭션 시작         //
2) 사용자의 로그인 여부 확인
3) 사용자의 글쓰기 내용의 오류 여부 확인
4) 첨부로 업로드된 파일 확인 및 저장
5) 사용자의 입력 내용을 DBMS에 저장
6) 첨부 파일 정보를 DBMS에 저장
7) 저장된 내용 또는 기타 정보를 DBMS에서 조회
8) 게시물 등록에 대한 알림 메일 발송
9) 알림 메일 발송 이력을 DBMS에 저장
<= 트랜잭션 종료(COMMIT) // 트랜잭션을 COMMIT 하고 커넥션을 종료(또는 커넥션 풀로 반납)
<= 데이터베이스 커넥션 반납 //
10) 처리 완료
```

* 2번, 3번, 4번의 작업이 아무리 빨라도 트랜잭션에 포함될 필요는 없다.
* 일반적으로 데이터베이스 커넥션은 개수가 제한적이어서 각 단위 프로그램이 커넥션을 소유하는 시간이 길어질수록 가능 가능한 여유 커넥션 개수는 줄어들 것이다.
* 8번의 경우 메일 전송, FTP 파일 전송, 네트워크를 통한 원격 서버와 통신하는 작업등은 어떻게서든 트랜잭션에서 제거하는 것이 좋다.
* 5번과 6번은 반드시 하나의 트랜잭션 / 7번은 단순 확인 및 조회이므로 트랜잭션에 포함할 필요없음 / 9번은 별도의 트랜잭션으로 분리

```
## 수정된 트랜잭션 처리 예제
1) 처리 시작
2) 사용자의 로그인 여부 확인
3) 사용자의 글쓰기 내용의 오류 여부 확인
4) 첨부로 업로드된 파일 확인 및 저장
=> 데이터베이스 커넥션 생성 // 데이터베이스의 커넥션을 생성(또는 커넥션 풀에서 가져옴)
=> 트랜잭션 시작         //
5) 사용자의 입력 내용을 DBMS에 저장
6) 첨부 파일 정보를 DBMS에 저장
<= 트랜잭션 종료(COMMIT)
7) 저장된 내용 또는 기타 정보를 DBMS에서 조회
8) 게시물 등록에 대한 알림 메일 발송
=> 트랜잭션 시작
9) 알림 메일 발송 이력을 DBMS에 저장
<= 트랜잭션 종료(COMMIT) //
<= 데이터베이스 커넥션 반납 // 트랜잭션을 COMMIT 하고 커넥션을 종료(또는 커넥션 풀로 반납)
10) 처리 완료
```

\
위의 예제가 (수정된 트랜잭션 예제) 최적의 트랜잭션 설계는 아닐 수 있다.\