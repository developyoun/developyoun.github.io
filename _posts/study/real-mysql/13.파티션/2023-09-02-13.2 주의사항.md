---
title: 13.2 주의사항

categories:
- study

tags:
- database

toc: true
toc_sticky: true
toc_label: Contents
---

MySQL의 파티션은 아직도 많은 제약을 지니고 있다.

## 13.2.1 파티션의 제약사항
- 스토어드 루틴이나 UDF, 사용자 변수 등을 파티션 표현식에 사용할 수 없다.
- ﻿﻿파티션 표현식은 일반적으로 칼럼 그 자체 또는 MySQL 내장 함수를 사용할 수 있는데, 여기서 일부 함수들은 파티 션 생성은 가능하지만 파티션 프루닝을 지원하지 않을 수도 있다.
- ﻿﻿프라이머리 키를 포함해서 테이블의 모든 유니크 인덱스는 파티션 키 칼럼을 포함해야 한다.
- ﻿﻿파티션된 테이블의 인덱스는 모두 로컬 인덱스이며, 동일 테이블에 소속된 모든 파티션은 같은 구조의 인덱스만 가 질 수 있다. 또한 파티션 개별로 인덱스를 변경하거나 추가할 수 없다.
- ﻿﻿동일 테이블에 속한 모든 파티션은 동일 스토리지 엔진만 가질 수 있다.
- ﻿﻿최대(서브 파티션까지 포함해서) 8192개의 파티션을 가질 수 있다.
- ﻿﻿파티션 생성 이후 MySQL 서버의 sal_ mode 시스템 변수 변경은 데이터 파티션의 일관성을 깨뜨릴 수 있다.
- ﻿﻿파티션 테이블에서는 외래키를 사용할 수 없다.
- ﻿﻿파티션 테이블은 전문 검색 인덱스 생성이나 전문 검색 쿼리를 사용할 수 없다.
- ﻿﻿공간 데이터를 저장하는 칼럼 타입(POINT, GEOMETRY, …)은 파티션 테이블에서 사용할 수 없다.
- ﻿﻿임시 테이블(Temporary table)은 파티션 기능 사용할 수 없다.

## 13.2.2 파티션 사용 시 주의사항
파티션의 목적이 작업의 범위를 좁히는 것인데, 유니크 인덱스는 중복 레코드에 대한 체크 작업 때문에 범위가 좁혀지지 않는다.
→ 또한 MySQL 파티션은 일반 테이블과 같이 별도의 파일로 관리되는데, MySQL 서버가 조작할 수 있는 파일의 개수에는 제약이 있다.

### 13.2.2.1 파티션과 유니크 키 (프라이머리 키 포함)
종류 관계없이 테이블에 유니크 인덱스가 있으면 파티션 키는 모든 모든 유니크 인덱스의 일부 또는 모든 컬럼을 포함해야 한다.
```sql
-- 1.
CREATE TABLE tb_partition ( 
	fd1 INT NOT NULL, 
	fd2 INT NOT NULL, 
	fd3 INT NOT NULL, 
	UNIQUE KEY (fd1, fd2)
) PARTITION BY HASH (fd3)
PARTITIONS 4;

-- 2.
CREATE TABLE tb partition ( 
	fd1 INT NOT NULL, 
	fd2 INT NOT NULL, 
	fd3 INT NOT NULL, 
	UNIQUE KEY (fd1),
	UNIQUE KEY (fd2)
) PARTITION BY HASH (fd1 + fd2)
PARTITIONS 4;

-- 3.
CREATE TABLE tb_partition ( 
	fd1 INT NOT NULL, 
	fa2 INT NOT NULL, 
	fd3 INT NOT NULL, 
	PRIMARY KEY (fd1),
	UNIQUE KEY (fd2, fd3)
) PARTITION BY HASH (fd1 + fd2)
PARTITIONS 4;
```
- 첫 번째 쿼리는 유니크 키와 파티션 키가 전혀 연관이 없어 불가능하다.
- 두 번째 쿼리는 유니크 키 컬럼인 fd1 만으로 파티션이 결정되지 않는다. fd2 컬럼값도 같이 있어야 파티션의 위치를 판단할 수 있다.
- 세 번째 쿼리 또한 두 번째 쿼리와 같이 프라이머리 키 컬럼인 fd1 값만으로 파티션이 판단되지 않으며, 유니크 키인 fd2와 fd3로도 파티션 위치를 결정할 수 없다.

### 13.2.2.2 파티션과 open_files_limit 시스템 변수 설정
MySQL에서는 일반적으로 테이블을 파일 단위로 관리하기 때문에 MySQL 서버에서 동시에 오픈된 파일의 개수가 상당히 많아 질 수 있다.
→ 이를 제한하기 위해 open_files_limit 시스템 변수에 동시에 오픈할 수 있는 적절한 파일의 개수를 설정할 수 있다.
→ 그래서 파티션을 많이 사용하는 경우에는 해당 시스템 변수를 적절히 높은 값으로 다시 설정해 줄 필요가 있다.