---
title: 6.1 페이지 압축

categories:
- real-mysql

tags:
- database
- study

toc: true
toc_sticky: true
toc_label: Contents
---

페이지 압축은 **Transparent Page Compression** 이라고도 불리는데, MySQL 서버가 디스크에 저장하는 시점에 데이터 페이지가 압축되어 저장되고,
반대로 MySQL 서버가 디스크에서 데이터 페이지를 읽어올 때 압축이 해제되기 때문이다.

→ 즉, 버퍼 풀에 데이터 페이지가 한 번 적재되면 InnoDB 스토리지 엔진은 압축이 해제된 상태로만 데이터 페이지를 관리한다.
→ 그래서 MySQL 서버의 내부 코드에서는 압축 여부와 관계없이 “투명"하게 작동한다. (❓)  

그러나, 여기서 한 가지 문제점이 있는데 16KB 데이터 페이지를 압축한 결과가 용량이 얼마나 될지 예측이 불가능한데 적어도 하나의 테이블은 동일한 크기의 페이지(블록)로 통일되어야 한다는 것이다.
→ 그래서 페이지 압축 기능은 운영체제별로 특정 버전의 파일 시스템에서만 지원되는 **펀치 홀**이라는 기능을 사용한다.
1. 16KB 페이지를 압축 (압축 결과를 7KB로 가정)  
2. MySQL 서버는 디스크에 압축된 결과 7KB를 기록 (MySQL 서버는 압축 데이터 7KB에 9KB의 빈 데이터를 기록)  
3. 디스크에 데이터를 기록한 후, 7KB 이후의 공간 9KB에 대해 펀치 홀을 생성  
4. 파일 시스템은 7KB만 남기고 나머지 디스크의 9KB 공간은 다시 운영체제로 반납
→ MySQL 서버는 특정 테이블에 대해 16KB 크기의 페이지를 유지하면서도 압축된 다양한 크기의 데이터 페이지를 디스크에 저장하고 압축된 만큼의 공간을 절약할 수 있다.  

하지만, MySQL 서버의 페이지 압축이 가진 문제는 아래와 같다.
-   펀치 홀 기능이 운영체제뿐만 아니라 하드웨어 자체에서도 해당 기능을 지원해야 사용 가능하다는 것
-   아직 파일 시스템 관련 명령어(유틸리티)가 펀치 홀을 지원하지 못하는 것.
	- MySQL 서버의 데이터 파일은 해당 서버에만 머무는 것이 아닌 백업했다가 복구하는 과정에서 데이터 파일 복사 과정이 실행되고, 그 외에도 많은 파일 관련 유틸리티들을 사용한다.

이런 이유로 실제 페이지 압축은 많이 사용되지 않는 상태다.
> 만약 페이지 압축을 이용하기 위해서는 테이블을 생성하거나 변경할 때 `COMPRESSION` 옵션을 설정하면 된다.  

```sql
-- 테이블 생성 시  
CREATE TABLE t1 (c1 INT) COMPRESSION="zlib";  
-- 테이블 변경 시  
ALTER TABLE t1 COMPRESSION="zlib";  
OPTIMIZE TABLE t1;
```
