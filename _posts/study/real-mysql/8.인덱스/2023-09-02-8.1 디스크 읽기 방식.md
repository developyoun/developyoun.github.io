---
title: 8.3 B-Tree 인덱스

categories:
- real-mysql

tags:
- study
- database

toc: true
toc_sticky: true
toc_label: Contents
---

> 인덱스는 데이터베이스 쿼리의 성능을 언급하면서 빼놓을 수 없는 없는 부분이다.

인덱스의 특성과 차이는 상당히 중요하며, 물리 수준의 모델링을 할 때도 중요한 요소가 될 것이다.
MySQL 8.0 버전은 다른 상용 RDBMS에서 제공하는 많은 기능을 지원하며, 기존 MyISAM 스토리지 엔진에서만 제공하던 **전문 검색**이나 **위치 기반 검색** 기능도 모두 InnoDB 스토리지 엔진에서 사용할 수 있다.
> 데이터베이스나 쿼리 튜닝에 어느 정도 지식을 갖춘 사용자가 절감하고 있듯이 데이터베이스의 성능 튜닝은 어떻게 디스크 I/O를 줄이느냐가 관건일 때가 상당히 많다.

## 8.1.1 디스크 읽기 방식
컴퓨터에서 CPU나 메모리 같은 주요 장치는 대부분 전자식 장치지만, *HDD*는 기계식 장치다. 그래서 **데이터베이스 서버에서는 항상 디스크 장치가 병목이 된다.**
→ 기계식 하드 디스크 드라이브를 대체하기 위해 전자직 저장 매체인 *SSD*가 출시되었다.
> SSD도 기존 HDD와 같은 인터페이스를 지원하므로 내장 디스크나 DAS 또는 SAN에 그대로 사용할 수 있다.

SSD는 기존 HDD에서 데이터 저장용 플래터를 제거하고, 대신 플래시 메모리를 장착하고 있다. 그래서 디스크 원판을 기계적으로 회전시킬 필요가 없으므로 아주 빨리 데이터를 읽고 쓸 수 있다.
→ 플래시 메모리는 전원이 공급되지 않아도 데이터가 삭제되지 않는다.
→ 컴퓨터의 메모리(D-RAM)보다는 느리지만, 기계식 하드 디스크 드라이브보다는 훨씬 빠르다.
> 요즘 DBMS용으로 사용할 서버에는 대부분 SSD를 채택하고 있다.

- 순차 I/O에서는 SSD가 HDD보다 약간 빠르거나 거의 비슷한 성능 보인다.
- 랜덤 I/O에서는 SSD가 HDD보다 훨씬 빠르다.

데이터베이스 서버에서 순차 I/O 작업은 그다지 비중이 크지 않고 랜덤 I/O를 통해 작은 데이터를 쓰는 작업이 대부분이므로, **SSD의 장점은 DBMS용 스토리지에 최적**이라고 볼 수 있다.

---
## 8.1.2 랜덤 I/O와 순차 I/O
> 랜덤 I/O라는 표현은 하드 디스크 드라이브의 플래터를 돌려서 읽어야 할 데이터가 저장된 위치로 디스크 헤더를 이동시킨 다음 데이터를 읽는 것을 의미한다.
![|600](https://i.imgur.com/VxyWqt1.png)

- 순차 I/O는 3개의 페이지를 디스크에 기록하기 위해 1번 시스템 콜을 요청한다
- 랜덤 I/O는 3개의 페이지를 디스크에 기록하기 위해 3번의 시스템 콜을 요청한다.

즉, 디스크에 기록해야 할 위치를 찾기 위해 순차 I/O는 디스크의 레드를 1번 움직이고, 랜덤 I/O는 디스크 헤드를 3번 움직인다. (순차 I/O가 랜덤 I/O보다 거의 3배 정도 빠르다고 할 수 있다.)
디스크의 성능은 디스크 헤더의 위치 이동 없이 **얼마나 많은 데이터를 한 번에 기록**하느냐에 의해 결정된다고 볼 수 있다.
> 데이터베이스 대부분의 작업은 이러한 작은 데이터를 빈번히 읽고 쓰기 때문에 mYSQL 서버에는 그룹 커밋이나 바이너리 로그 버퍼 또는 InnoDB 로그 버퍼 등의 기능이 내장되어 있다.

디스크 원판을 가지지 않는 SSD는 랜덤 I/O와 순차 I/O의 차이가 없을 것으로 예측하지만, **실제로는 그렇지 않다.**
SSD 드라이브에서도 랜덤 I/O는 여전히 순차 I/O보다 **전체 스루풋(Throughput)이 떨어진다.**
> Thoughput ?
> MySQL에서 throughput은 시스템이나 어플리케이션이 처리하는 일의 양을 측정하는 지표이다. 즉, 시스템이나 어플리케이션이 단위 시간당 처리하는 작업의 수를 말한다.
> MySQL에서 throughput을 측정하는 방법에는 여러가지가 있다. 예를 들어, 쿼리 실행 시간, 페이지 요청 응답 시간, 쓰기/읽기 작업 수 등을 측정할 수 있으며 이러한 측정 지표들을 통해 시스템의 성능을 평가하고, 병목 현상을 파악하고, 최적화 방안을 모색할 수 있다.

사실 쿼리를 튜닝해서 랜덤 I/O를 순차 I/O로 바꿔서 실행할 방법은 많지 않다.
일반적으로 쿼리를 튜닝하는 것은 **랜덤 I/O 자체를 줄여주는 것이 목적**이라고 할 수 있으며, 랜덤 I/O를 줄인다는 것은 쿼리를 처리하는 데 꼭 **필요한 데이터만 읽도록 쿼리를 개선하는 것을 의미**한다.
> 인덱스 레인지 스캔은 데이터를 읽기 위해 랜덤 I/O를 사용하며, 풀 테이블 스캔은 순차 I/O를 사용한다.
> 그래서 큰 테이블의 레코드 대부분을 읽는 작업에서는 인덱스를 사용하지 않고 풀 테이블 스캔을 사용하도록 유도할때도 있다.
