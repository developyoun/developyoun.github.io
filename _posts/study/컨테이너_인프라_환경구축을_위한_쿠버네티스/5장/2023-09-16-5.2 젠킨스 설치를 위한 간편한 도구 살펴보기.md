---
title: 5.2 젠킨스 설치를 위한 간편한 도구 살펴보기

categories:
- 쿠버네티스/도커

tags:
- kubenetes
- docker

toc: true
toc_sticky: true
toc_label: Contents
---

#### 5.2.1 배포 간편화 도구 비교하기

* 큐브시티엘(kubectl)
    * 쿠버네티스에 기본으로 포함된 커맨드라인 도구로, 추가 설치없이 바로 사용할 수 있다.
    * 오브젝트생성과 쿠버네티스 클러스에 존재하는 오브젝트로, 이벤트 등의 정보를 확인하는데 사용하는 활용도 높은 도구.
    * 오브젝트의 명세가 정의된 야믈 파일을 인자로 입력받아 파일 내용에 따라 오브젝트를 배포할 수도 있다.
    * 정의된 매니페스트 파일을 그대로 배포하기 때문에 개별적인 오브젝트를 관리하거나 배포할 때 사용하는 것이 좋다.
* 커스터마이즈(kustomize)
    * 오브젝트를 사용자의 의도에 따라 유동적으로 배포할 수 있다.
    * 별도의 커스터마이즈 실행 파일을 활용해 커스터마이즈 명세를 따르는 야믈 파일을 생성할 수 있다.
    * 명세와 관련된 야믈 파일에 변수나 템플릿을 사용하지는 않지만, 명령어로 배포 대상 오브젝트의 이미지 태그와 레이블 같은 명세를 명세를 변경하거나 일반 파일을 이용해 컨피그맵과 시크릿을 생성하는 기능을 지원한다.
    * 운영 중인 환경에서 배포 시 가변적인 요소를 적용하는 데 적합하다.
* 헬름(helm)
    * 쿠버네티스 사용자의 70% 이상이 사용하고 있을 정도로 널리 알려진 도구이다.
    * 오브젝트 배포에 필요한 사양이 이미 정의된 차트라는 패키지를 활용한다.
    * 앞선 두 가지 도구와 달리 헬름 차트 저장소가 온라인에 있기 때문에 패키지를 검색하고 내려받아 사용하기 매우 편리하다.
    * 헬름 차트는 자체적인 템플릿 문법을 사용하므로 가변적인 인자를 배포할 때 적용해 다양한 배포 환경에 맞추거나 원하는 조건을 적용할 수 있다.
    * 헬름 오브젝트를 묶어 패키지 단위로 관리하므로 단순한 1개의 명령어로 애플리케이션에 필요한 오브젝트를 구성할 수 있다.

| 구분     | 큐브시티엘           | 커스터마이즈                | 헬름                  |
| ------ | --------------- | --------------------- | ------------------- |
| 설치 방법  | 쿠버네티스에 기본 포함    | 별도 실행 파일 또는 쿠버네티스에 통합 | 별도 설치               |
| 배포 대상  | 정적인 야믈 파일       | 커스터마이즈 파일             | 패키지(차트)             |
| 주 용도   | 오브젝트 관리 및 배포    | 오브젝트의 가변적 배포          | 패키지 단위 오브젝트 배포 및 관리 |
| 가변적 환경 | 대응 힘듦(야믈 수정 필요) | 간단한 대응 가능             | 복잡한 대응 가능           |
| 기능 복잡도 | 단순함             | 보통                    | 복잡함                 |

#### 5.2.2 커스터마이즈로 배포 간편화하기

> 커스터마이즈를 통한 배포는 kubectl에 구성돼 있는 매니페스트를 고정적으로 이용해야 하는 기존 방식을 유연하게 만든다.

* 커스터마이즈는 야믈 파일에 정의된 값을 사용자가 원하는 값으로 변경할 수 있다.
* 커스터마이즈는 `kustomize` 명령을 제공하는데, `create` 옵션을 줌으로서, kustomizaion.yaml 이라는 기본 매니페스트를 만들고, 파일에 변경해야하는 값을 적용한다. 그리고 `build` 옵션으로 변경할 내용이 적용된 최종 야믈 파일을 저장하거나 변경된 내용이 바로 실행되도록 지정한다.
* 그러나, 커스터마이즈는 여러 가지 변경할 부분을 사용자가 직접 kustomization.yaml 에 추가하고 최종적으로 필요한 매니페스트를 만들어 배포해야 한다.

#### 5.2.3 헬름으로 배포 간편화하기

> 헬름을 통한 배포는 커스터마이즈에서 제한적이었던 주소 할당 영역과 같은 값을 대체하면서 간단하게 설치할 수 있도록 설계되어 있다.

**헬름의 작동 원리**

헬름은 쿠버네티스에 패키지를 손쉽게 배포할 수 있도록 패키지를 관리하는 쿠버네티스 전용 패키지 매니저이다. (일반적으로 패키지는 실행 파일뿐만 아니라 실행 환경에 필요한 의존성 파일과 환경 정보들의 묶음이다)

패키지 매니저는 외부에 있는 저장소에서 패키지 정보를 받아와 패키지를 안정적으로 관리하는 도구이며, 다양한 목적으로 사용되지만 가장 중요한 목적은 설치에 필요한 의존성 파일들을 관리하고 간편하게 설치할 수 있도록 도와주는 것이다.

| 플랫폼   | 패키지 매니저  | 저장소               | 사용 목적           |
| ----- | -------- | ----------------- | --------------- |
| 리눅스   | yum, apt | 배포판 저장소           | 스프트웨어 의존성 관리    |
| 파이썬   | pip      | pypi.org          | 파이썬 모듈 의존성 관리   |
| 자바    | maven    | mvnrepository.com | 자바 라이브러리 의존성 관리 |
| 쿠버네티스 | helm     | artifacthub.io    | 쿠버네티스 패키지 관리    |

**- 플랫폼 별 패키지 매니저**

* 패키지 검색
    * 설정한 저장소에서 패키지를 검색하는 기능을 제공.
    * 대부분 저장소는 목적에 따라 변경할 수 있다.
* 패키지 관리
    * 저장소에서 패키지 정보를 확인
    * 사용자 시스템에 패키지 설치, 삭제, 업그레이드, 되돌리기 등을 할 수 있다.
* 패키지 의존성 관리
    * 패키지를 설치할 때 의존하는 소프트웨어를 같이 설치.
    * 삭제할 때 같이 삭제할 수 있도록 한다.
* 패키지 보안 관리
    * 디지털 인증서와 패키지에 고유하게 발행하는 체크섬 값으로 패키지의 소프트웨어나 의존성이 변조되었는지 검사.

헬름은 커스터마이즈에서 변경할 수 없는 값을 환경에 맞게 변경할 수 있다는 점외에도 여러 장점이 있다.

* 헬름은 파일 구분자인 "---" 로 묶어 단일 야믈로 작성해 배포할 수 있다.
    * 이런경우, 변경 사항을 추적할 때 모든 내용이 한 야믈 파일에 담겨 있기에 충돌이 발생할 수 있다.
    * 목적에 맞게 디렉토리를 만들고 야플 파일을 분리해 관리하면서 배포 시에는 `kubectl apply -f` 의 인자로 넘겨 이 문제를 해결할 수 있다.
    * 하지만 이런 방식은 요구 조건에 변경되는 야믈 파일을 매번 개별 디렉토리에 작성해야 하므로 디렉토리가 늘어날수록 관리 영역도 늘게 된다.
* 헬름을 사용하면 요구 조건 별로 리소스를 편집하거나 변수를 넘겨서 처리하는 패키지를 만들 수 있다.
    * 다양한 요구 조건을 처리할 수 있는 패키지를 차트라고 한다.
    * 헬름 저장소에 공개해 여러 사용자와 공유하고, 각 사용자는 공개된 저장소에 등록된 차트를 이용해 어플리케이션을 원하는 형태로 쿠버네티스에 배포할 수 있다.
* 헬름은 배포한 어플리케이션을 업그레이드하거나 되돌릴 수 있는 기능과 삭제할 수 있는 기능을 제공한다.
* 헬름의 기본 저장소는 아티팩트 허브로, 다른 패키지 매니저처럼 외부에 있다.
    * 그러나 다른 저장소와 달리 아티팩트허브에서는 설치할 패키지에 대한 경로만을 제공한다.

**헬름의 흐름 영역**

* 생산자 영역
    * 생산자가 헬름 명령으로 작업 공간을 생성하면 templates 디렉터리로 어플리에킹션 배포에 필요한 여러 야믈 파일과 구성 파일을 작성할 수 있다.
    * templates 디렉토리에서 조건별 분기, 값 전달 등을 처리할 수 있도록 values.yaml 에 설정된 키를 사용한다.
        * 값이 전달되지 않으면 기본값으로 처리하도록 values.yaml에 설정할 수 있다.
    * 필요한 패키지의 여러 분기 처리나 배포에 대한 구성이 완료되면 생산자는 차트의 이름, 목적, 배포되는 어플리케이션 버전과 같은 패키지 정보를 charts.yaml에 채워 넣는다.
    * 차트 구성이 완료되면 생산자가 생산자 저장소에 업로드 한다.
    * 업로드한 생산자 저장소를 아티팩트허브에 등록하면 사용자는 아티팩트허브에서 생산자가 만든 저장소를 찾을 수 있다.
* 아티팩트 영역
    * 아티팩트허브 검색을 통해 사용자가 찾고자 하는 어플리케이션 패키지를 검색하면 해당 패키지가 저장된 주소를 확인한다.
    * 확인한 주소는 각 어플리케이션을 개발하는 주체가 관리한다.
* 사용자 영역
    * 사용자는 설치하려는 어플리케이션의 차트 저장소 주소를 아티팩트허브에서 얻으면 헬름을 통해서 주소를 등록한다.
    * 이를 최신버전으로 업데이트한 이후에 차트를 내려받고 설치한다.
    * 헬름을 통해 쿠버네티스에 설치된 어플리케이션 패키지를 릴리즈라고 한다.
    * 헬름을 통해 배포된 릴리즈를 다시 차트를 사용해 업그레이드할 수 있고, 원래대로 되돌릴 수 있다. (헬름 릴리즈 제거도 가능)