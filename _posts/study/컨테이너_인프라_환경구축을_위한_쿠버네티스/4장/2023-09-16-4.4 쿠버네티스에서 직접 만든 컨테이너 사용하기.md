---
title: 4.4 쿠버네티스에서 직접 만든 컨테이너 사용하기

categories:
- 쿠버네티스/도커

tags:
- kubenetes
- docker

toc: true
toc_sticky: true
toc_label: Contents
---

> 쿠버네티스에서 이미지를 사용하려면 쿠버네티스가 이미지를 불러올 수 있는 공간에 이미지를 넣어 두어야 한다.

#### 4.4.1 쿠버네티스에서 도커 이미지 구동하기

* 쿠버네티스는 컨테이너를 효과적으로 다루기 위해서 만들어졌고, 컨테이너인 파드도 쉽게 부를 수 있다.
* 직접 만든 컨테이너 이미지도 kubectl 명령으로 쿠버네티스 클러스터에서 바로 구동할 수 있다.
* 컨테이너 이미지를 쿠버네티스에 배포하려면 해당 배포된 워커노드에서만 가능하다.
* 위와 같은 문제를 해결하기 위해선 2가지 방안이 존재한다.
    1. 기본으로 사용하는 도커 허브에 이미지를 올려서 다른 노드에서 내려받는 방법.
    2. 쿠버네티스 클러스터가 접근할 수 있는 곳에 이미지 레지스트리를 만들고 그곳에서 받아오도록 하는 방법.

#### 4.4.2 레지스트리 구성하기

호스트에서 생성한 이미지를 쿠버네티스에서 사용하려면 모든 노드에서 공통으로 접근하는 레지스트리가 필요하다.

> 도커나 쿠버네티스는 도커 허브라는 레지스트리에서 이미지를 내려받을 수 있어, 인터넷(네트워크)가 연결되어 있다면 이 방법을 사용할 수 있다.

직접 만든 이미지를 외부에 공개하지 않고, 제약없이 사용할 수 있는 저장소가 필요하다가면 레지스트리를 구축하는 방법이 있다. 이는 인터넷을 연결할 필요가 없으므로 보안이 중요한 내부 전산망에서도 구현이 가능하다.

> 도커 허브에서 제공하는 사설 저장소도 있지만, 이는 무료 사용자에게 1개밖에 허용하지 않으며 비공개 저장소를 사용하려면 유료 구독을 해야한다. 또한, 무료 사용자는 이미지를 내려받는 횟수에 제약이 있다.

**레지스트리 종류**

* Quay (키)
    * 레드햇에서 제공하는 이미지 레지스트리
    * 오픈소스로 제공되는 무료버전과 보유한 서버에 직접 설치해 사용할 수 있는 유료 버전, 비용을 지불하고 클라우드에서 이용할 수 있는 서비스형 상품이 있다.
    * 유료 버전이나 서비스형 상품은 제품에 대한 신뢰성 보증과 기술 지원 서비스를 받을 수 있으므로 안정적인 서비스를 운영하는 사용자에게 적합
* Harbor (하버)
    * Project Harbor에서 오픈 소스로 제공하는 레지스트리
    * 도커 이미지 외에도 헬름 차트도 저장할 수 있다
    * 이미지와 헬름 차트를 함께 저장할 수 있어 두 가지 모두를 사용하는 사용자에게 알맞다.
* Nexus Repository (넥서스 레파지토리)
    * Sonatype에서 만든 레지스트리
    * 오픈 소스로 제공되는 무료 버전과 유료 버전이 있다.
    * 
    * 유료 버전은 기술 지원과 다양한 기능을 제공받을 수 있다.
    * 도커 이미지 외에도 다양한 형식의 파일을 저장할 수 있어서 여러 형식의 패키지를 하나의 저장소에 관리하려는 사용자에게 적합
    * 다양한 형식을 지원하는 점 덕뿐에 레지스트리 중 가장 많은 사용자를 보유하고 있다.
* Docker Registry (도커 레지스트리)
    * 도커에서 제공하는 레지스트리
    * 무료로 사용할 수 있고 도커 이미지만 저장할 수 있다.
    * 도커 허브에서 제공하는 레지스트리 전용 컨테이너 이미지로 간편하게 설치할 수 있다.
    * 기능이 매우 간단해서 개인용이나 테스트용으로 적합하다.

| 구분    | 키           | 하버         | 넥서스 레포지토리 | 도커 레지스트리 |
| ----- | ----------- | ---------- | --------- | -------- |
| 가격    | 유/무료        | 무료         | 유/무료      | 무료       |
| 저장 형식 | 도커 이미지, 헬름  | 도커 이미지, 헬름 | 다양함       | 도커 이미지   |
| 설치 방법 | 직접 설치, 클라우드 | 직접 설치      | 직접 설치     | 직접 설치    |
| 기능    | 부가 기능 있음    | 부가 기능 있음   | 매우 많음     | 최소       |
| 관련 자료 | 적음          | 보통         | 많음        | 많음       |